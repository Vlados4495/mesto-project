(()=>{"use strict";var e=document.querySelector(".profile__edit-button"),t=document.querySelector(".profile__btn-edit"),n=(document.querySelector(".popup__button"),document.querySelector(".profile__add-button")),o=(document.querySelector("#popup-add_submit"),document.querySelector("#popup-edit")),r=document.querySelector("#popup__edit_avatar"),c=(document.querySelector("#popup__close-btn"),document.getElementById("popup-add")),u=(document.getElementById("popup__close"),document.querySelector(".popup__card")),a=(document.querySelector("#popup__card_close"),document.querySelectorAll(".popup")),i=(document.querySelector("#popup__confirm-delete"),document.querySelector(".profile__title")),d=document.querySelector(".profile__subtitle"),s=document.querySelector(".profile__avatar"),l=document.querySelector(".cards__items"),p=document.querySelector(".popup__card_image"),_=document.querySelector(".popup__card_title"),f=document.querySelector("#input-popup-name"),m=document.querySelector("#input-popup-link"),v=document.querySelector(".popup__avatar"),y=document.querySelector(".popup__form_add"),h=document.querySelector(".popup__form"),S=document.querySelector(".popup__form_avatar"),b=document.querySelector("#input-popup-title"),q=document.querySelector("#input-popup-subtitle"),L={baseUrl:"https://nomoreparties.co/v1/plus-cohort-11",headers:{authorization:"2ce78970-65cf-4453-9ecd-08fb86edda40","Content-Type":"application/json"}};function E(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status," ").concat(e.statusText))}function k(e){e.classList.add("popup_opened"),document.addEventListener("keydown",g)}function C(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",g)}function g(e){"Escape"===e.key&&C(document.querySelector(".popup_opened"))}function x(e,t,n,o,r){var c=document.querySelector("#cards__template").content.querySelector(".cards__item").cloneNode(!0),a=c.querySelector(".cards__item-image"),i=c.querySelector(".cards__title"),d=c.querySelector(".cards__like"),s=c.querySelector("#delete_button");a.src=e,a.alt=t,a.id=o,i.textContent=t;var l=c.querySelector(".cards__likes-counter");return l.textContent=r,d.addEventListener("click",(function(e){var t,n;e.target.classList.contains("cards__like_active")?(e.target.classList.remove("cards__like_active"),function(e,t){fetch("".concat(L.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:L.headers}).then((function(e){return E(e)})).then((function(e){t.textContent=e.likes.length}))}(o,l)):(e.target.classList.add("cards__like_active"),t=o,n=l,fetch("".concat(L.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:L.headers}).then((function(e){return E(e)})).then((function(e){n.textContent=e.likes.length})))})),"e262b97f0d05a1bc5248b5ec"===n&&(s.style.display="block",s.addEventListener("click",(function(){var e;c.remove(),e=o,fetch("".concat(L.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:L.headers}).then((function(e){return E(e)}))}))),a.addEventListener("click",(function(){k(u),p.src=e,p.alt=t,_.textContent=t})),c}var A=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(n.classList.remove(e.disabledButtonClass),n.removeAttribute("disabled","")):(n.classList.add(e.disabledButtonClass),n.setAttribute("disabled",""))};fetch("".concat(L.baseUrl,"/users/me"),{headers:L.headers}).then((function(e){return E(e)})).then((function(e){i.textContent=e.name,d.textContent=e.about,s.src=e.avatar})).catch((function(e){console.log(e)})),fetch("".concat(L.baseUrl,"/cards"),{headers:L.headers}).then((function(e){return E(e)})).then((function(e){e.forEach((function(e){var t=x(e.link,e.name,e.owner._id,e._id,e.likes.length);l.append(t)}))})).catch((function(e){console.log(e)})),e.addEventListener("click",(function(){k(o)})),t.addEventListener("click",(function(){k(r)})),n.addEventListener("click",(function(){k(c)})),a.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&C(e),t.target.classList.contains("popup__closed")&&C(e)}))})),y.addEventListener("submit",(function(e){var t;t=x(m.value,f.value,undefined,undefined,undefined),l.prepend(t),function(e,t){fetch("".concat(L.baseUrl,"/cards/"),{method:"POST",headers:L.headers,body:JSON.stringify({name:t,link:e})}).then((function(e){return E(e)}))}(m.value,f.value),e.preventDefault(),y.reset();var n=y.querySelector(".popup__button");n.disabled=!0,n.classList.add("popup__button_inactive"),C(c)})),h.addEventListener("submit",(function(e){var t,n;e.preventDefault(),i.textContent=b.value,d.textContent=q.value,t=b.value,n=q.value,fetch("".concat(L.baseUrl,"/users/me"),{method:"PATCH",headers:L.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return E(e)})),C(o)})),S.addEventListener("submit",(function(e){var t;e.preventDefault(),s.src=v.value,t=v.value,fetch("".concat(L.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:L.headers,body:JSON.stringify({avatar:t})}).then((function(e){return E(e)})),C(r)})),e.addEventListener("click",(function(){b.value=i.textContent,q.value=d.textContent})),function(e){Array.from(document.querySelectorAll(e.formListSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),Array.from(t.querySelectorAll(e.formSet)).forEach((function(t){!function(e,t){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);A(e,n,o),n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){n.validity.valid?function(e,t,n){var o=t.querySelector("#".concat(n.id,"-error"));n.classList.remove(e.errorClass),o.textContent=""}(e,t,n):function(e,t,n){var o=t.querySelector("#".concat(n.id,"-error"));n.classList.add(e.errorClass),o.textContent=n.validationMessage}(e,t,n)}(e,t,r),A(e,n,o)}))}))}(e,t)}))}))}({formListSelector:".form",formSet:".form__set",inputSelector:".popup__input",submitButtonSelector:".popup__button",disabledButtonClass:"popup__button_inactive",errorClass:"popup__input-error_active"})})();